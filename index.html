<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Seismic Runner ‚Äì Rock Bot Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --dawn: #FF6B35;
  --dusk: #5C2D91;
  --dusk-light: #8B5CF6;
  --cloud: #4A90D9;
  --navy: #1a0d05;
  --navy-mid: #2d1a0a;
  --neon: #d4a574;
}

body {
  background: #3a2010;
  font-family: 'Share Tech Mono', monospace;
  color: #eee;
  overflow: hidden;
  user-select: none;
  height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

/* ‚îÄ‚îÄ NAME SCREEN ‚îÄ‚îÄ */
#nameScreen {
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse at 25% 75%, rgba(184,133,90,0.4) 0%, transparent 55%),
    radial-gradient(ellipse at 78% 25%, rgba(122,79,45,0.5) 0%, transparent 50%),
    linear-gradient(135deg, #1a0d05 0%, #2d1a0a 45%, #3a2010 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 200;
  text-align: center;
  padding: 30px;
  animation: fadeIn 0.5s ease;
}

#nameScreen h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(2rem, 7vw, 3.5rem);
  font-weight: 900;
  margin-bottom: 0.4rem;
  color: #d4a574;
  text-shadow: 0 0 30px rgba(212,165,116,0.7), 0 0 60px rgba(184,133,90,0.4);
  letter-spacing: 2px;
}

#nameScreen .ns-sub {
  color: #b8855a;
  font-size: 0.9rem;
  margin-bottom: 2rem;
}

#nameScreen .ns-box {
  background: rgba(58,32,16,0.6);
  border: 1px solid rgba(140,92,51,0.7);
  border-radius: 14px;
  padding: 28px 36px;
  width: min(420px, 90vw);
  margin-bottom: 1.5rem;
}

#nameScreen label {
  display: block;
  font-size: 0.75rem;
  letter-spacing: 2px;
  color: #b8855a;
  text-transform: uppercase;
  margin-bottom: 10px;
  text-align: left;
}

#playerNameInput {
  width: 100%;
  padding: 12px 16px;
  background: rgba(26,13,5,0.8);
  border: 2px solid #8c5c33;
  border-radius: 8px;
  color: #d4a574;
  font-family: 'Orbitron', sans-serif;
  font-size: 1rem;
  font-weight: 700;
  letter-spacing: 1px;
  outline: none;
  transition: border-color 0.2s;
  text-align: center;
}
#playerNameInput:focus { border-color: #d4a574; }
#playerNameInput::placeholder { color: #5a3a1a; font-weight: 400; font-size: 0.85rem; }

.ns-wallet {
  margin-top: 14px;
  padding: 10px;
  background: rgba(212,165,116,0.08);
  border-radius: 8px;
  font-size: 0.85rem;
  color: #b8855a;
  min-height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
.ns-wallet .wallet-amt { color: #d4a574; font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 1rem; }

#nameSubmitBtn {
  padding: 13px 36px;
  font-family: 'Orbitron', sans-serif;
  font-size: 0.9rem;
  font-weight: 700;
  letter-spacing: 1px;
  background: #8c5c33;
  color: #fff;
  border: 2px solid #d4a574;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}
#nameSubmitBtn:hover { background: #7a4f2d; box-shadow: 0 0 20px rgba(212,165,116,0.4); }

/* leaderboard on name screen */
.ns-leaderboard {
  width: min(420px, 90vw);
  background: rgba(58,32,16,0.4);
  border: 1px solid rgba(140,92,51,0.4);
  border-radius: 12px;
  padding: 16px 20px;
}
.ns-leaderboard h3 {
  font-family: 'Orbitron', sans-serif;
  font-size: 0.65rem;
  letter-spacing: 3px;
  color: #b8855a;
  text-transform: uppercase;
  margin-bottom: 10px;
}
.lb-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 0;
  border-bottom: 1px solid rgba(140,92,51,0.2);
  font-size: 0.82rem;
}
.lb-row:last-child { border-bottom: none; }
.lb-rank { color: #8c5c33; width: 20px; }
.lb-name { color: #d4a574; flex: 1; padding: 0 8px; }
.lb-coins { color: #FFD700; font-family: 'Orbitron', sans-serif; font-size: 0.8rem; }
.lb-empty { color: #5a3a1a; font-size: 0.8rem; text-align: center; padding: 10px 0; }

/* ‚îÄ‚îÄ INTRO (difficulty) ‚îÄ‚îÄ */
#intro {
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse at 25% 75%, rgba(184,133,90,0.4) 0%, transparent 55%),
    radial-gradient(ellipse at 78% 25%, rgba(122,79,45,0.5) 0%, transparent 50%),
    radial-gradient(ellipse at 55% 50%, rgba(58,32,16,0.3) 0%, transparent 65%),
    linear-gradient(135deg, #1a0d05 0%, #2d1a0a 45%, #3a2010 100%);
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 100;
  text-align: center;
  padding: 30px;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

#intro h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(2rem, 7vw, 3.5rem);
  font-weight: 900;
  margin-bottom: 0.3rem;
  color: #d4a574;
  text-shadow: 0 0 30px rgba(212,165,116,0.7), 0 0 60px rgba(184,133,90,0.4);
  letter-spacing: 2px;
}

#intro .player-greeting {
  font-size: 0.85rem;
  color: #8c5c33;
  margin-bottom: 0.3rem;
  letter-spacing: 1px;
}

#intro .total-coins-banner {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: rgba(212,165,116,0.1);
  border: 1px solid rgba(212,165,116,0.3);
  border-radius: 20px;
  padding: 6px 18px;
  margin-bottom: 1.4rem;
  font-size: 0.9rem;
  color: #b8855a;
}
#intro .total-coins-banner .tc-num {
  font-family: 'Orbitron', sans-serif;
  color: #FFD700;
  font-weight: 700;
  font-size: 1rem;
}

.controls-hint {
  background: rgba(58,32,16,0.4);
  border: 1px solid rgba(140,92,51,0.6);
  border-radius: 10px;
  padding: 12px 24px;
  margin-bottom: 1.5rem;
  font-size: 0.9rem;
  color: #c4a080;
  line-height: 1.8;
}
.controls-hint span { color: #d4a574; font-weight: bold; }

.mode-buttons { display: flex; gap: 14px; flex-wrap: wrap; justify-content: center; margin-bottom: 12px; }

.mode-buttons button {
  padding: 13px 28px;
  font-family: 'Orbitron', sans-serif;
  font-size: 0.9rem;
  font-weight: 700;
  letter-spacing: 1px;
  border: 2px solid transparent;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-easy { background: #1a6b3c; color: #fff; border-color: #27a560; }
.btn-easy:hover { background: #145530; box-shadow: 0 0 20px rgba(39,165,96,0.4); }
.btn-hard { background: #c0392b; color: #fff; border-color: #e74c3c; }
.btn-hard:hover { background: #962d22; box-shadow: 0 0 20px rgba(231,76,60,0.4); }
.btn-vhard { background: #1a0a00; color: #ff4500; border-color: #ff4500; }
.btn-vhard:hover { background: #2d1000; box-shadow: 0 0 20px rgba(255,69,0,0.6); }

.btn-switch-player {
  background: transparent;
  color: #8c5c33;
  border: 1px solid #5a3418;
  border-radius: 6px;
  padding: 7px 18px;
  font-family: 'Share Tech Mono', monospace;
  font-size: 0.78rem;
  cursor: pointer;
  transition: all 0.2s;
}
.btn-switch-player:hover { color: #d4a574; border-color: #8c5c33; }

/* ‚îÄ‚îÄ HUD ‚îÄ‚îÄ */
#hud {
  position: fixed;
  top: 0; left: 0; right: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
  background: rgba(26,13,5,0.95);
  backdrop-filter: blur(6px);
  border-bottom: 2px solid #8c5c33;
  z-index: 50;
  font-family: 'Orbitron', sans-serif;
}

.hud-item { display: flex; flex-direction: column; align-items: center; }
.hud-label { font-size: 0.5rem; letter-spacing: 2px; color: #b8855a; text-transform: uppercase; }
.hud-val { font-size: 1.1rem; font-weight: 700; color: #d4a574; }
#livesDisplay { color: #f87171; font-size: 1.2rem; letter-spacing: 3px; }

/* All-time coin display in HUD */
#allTimeCoinsHud {
  display: flex; flex-direction: column; align-items: center;
  background: rgba(212,165,116,0.06);
  border: 1px solid rgba(212,165,116,0.2);
  border-radius: 6px;
  padding: 4px 10px;
}
#allTimeCoinsHud .hud-val { color: #FFD700; font-size: 1rem; }

/* ‚îÄ‚îÄ GAME WRAPPER ‚îÄ‚îÄ */
#gameWrapper {
  width: 100vw;
  padding-top: 58px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* ‚îÄ‚îÄ GAME AREA ‚îÄ‚îÄ */
#gameArea {
  position: relative;
  width: 100vw;
  height: 300px;
  overflow: hidden;
  background: linear-gradient(180deg, #2d1a0a 0%, #3a2010 60%, #4a2a14 100%);
  border-top: 2px solid #8c5c33;
  border-bottom: 2px solid #8c5c33;
}

#gameArea::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image:
    radial-gradient(2px 2px at 10% 20%, rgba(212,165,116,0.4) 0%, transparent 100%),
    radial-gradient(2px 2px at 30% 60%, rgba(184,133,90,0.3) 0%, transparent 100%),
    radial-gradient(2px 2px at 60% 30%, rgba(212,165,116,0.3) 0%, transparent 100%),
    radial-gradient(2px 2px at 80% 70%, rgba(140,92,51,0.25) 0%, transparent 100%),
    radial-gradient(2px 2px at 45% 15%, rgba(212,165,116,0.4) 0%, transparent 100%),
    radial-gradient(2px 2px at 70% 50%, rgba(184,133,90,0.2) 0%, transparent 100%);
  pointer-events: none;
}

#seismicText {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  white-space: nowrap;
  font-family: 'Orbitron', sans-serif;
  font-weight: 900;
  font-size: 5rem;
  letter-spacing: 0.3em;
  color: rgba(212,165,116,0.12);
  text-transform: uppercase;
  z-index: 0;
  animation: scrollText 18s linear infinite;
  pointer-events: none;
  user-select: none;
  width: max-content;
}
@keyframes scrollText {
  0%   { transform: translateY(-50%) translateX(0); }
  100% { transform: translateY(-50%) translateX(-50%); }
}

#seismicBg {
  position: absolute;
  bottom: 0; left: 0;
  width: 200%; height: 50px;
  background: repeating-linear-gradient(
    90deg,
    rgba(140,92,51,0.5) 0, rgba(140,92,51,0.5) 2px,
    transparent 2px, transparent 40px
  );
  animation: moveSeismic 1.2s linear infinite;
  z-index: 1;
}
@keyframes moveSeismic {
  0%   { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}

#ground {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 4px;
  background: linear-gradient(90deg, #3a2010, #b8855a, #d4a574, #b8855a, #3a2010);
  background-size: 300%;
  animation: groundGlow 3s linear infinite;
  z-index: 2;
  box-shadow: 0 0 12px #8c5c33, 0 0 24px rgba(140,92,51,0.5);
}
@keyframes groundGlow { 0%{background-position:0%} 100%{background-position:200%} }

/* ‚îÄ‚îÄ CHARACTER ‚îÄ‚îÄ */
#character {
  position: absolute;
  bottom: 4px; left: 70px;
  width: 72px; height: 90px;
  z-index: 10;
  transition: filter 0.1s;
  image-rendering: crisp-edges;
}
#character svg { width: 100%; height: 100%; overflow: visible; animation: botWalk 0.35s ease-in-out infinite alternate; }
@keyframes botWalk { from{transform:translateY(0px)} to{transform:translateY(3px)} }

#bot-leg-l { animation: legL 0.35s ease-in-out infinite alternate; transform-origin: 50% 0%; }
@keyframes legL { from{transform:rotate(-8deg)} to{transform:rotate(8deg)} }
#bot-leg-r { animation: legR 0.35s ease-in-out infinite alternate; transform-origin: 50% 0%; }
@keyframes legR { from{transform:rotate(8deg)} to{transform:rotate(-8deg)} }
#bot-arm-l { animation: armL 0.35s ease-in-out infinite alternate; transform-origin: 80% 20%; }
@keyframes armL { from{transform:rotate(6deg)} to{transform:rotate(-6deg)} }
#bot-arm-r { animation: armR 0.35s ease-in-out infinite alternate; transform-origin: 20% 20%; }
@keyframes armR { from{transform:rotate(-6deg)} to{transform:rotate(6deg)} }

#character.hit { filter: brightness(2.5) saturate(0) sepia(1) hue-rotate(320deg); animation: shake 0.3s ease; }
@keyframes shake { 0%,100%{left:70px} 25%{left:64px} 75%{left:76px} }

/* ‚îÄ‚îÄ OBSTACLES ‚îÄ‚îÄ */
.obstacle {
  position: absolute; bottom: 4px;
  border-radius: 4px 4px 0 0; z-index: 5;
  background: linear-gradient(180deg, #5a3418, #2d1a0a);
  box-shadow: 0 0 8px rgba(58,32,16,0.8), inset 0 1px 0 rgba(212,165,116,0.15);
}
.obstacle::before {
  content: ''; position: absolute;
  top: 0; left: 0; right: 0; height: 4px;
  background: #b8855a; border-radius: 4px 4px 0 0;
  box-shadow: 0 0 8px #8c5c33;
}

.coin {
  position: absolute; width: 22px; height: 22px; border-radius: 50%;
  background: radial-gradient(circle at 35% 35%, #d4a574, #7a4f2d);
  box-shadow: 0 0 10px rgba(212,165,116,0.8); z-index: 6;
  animation: coinBob 0.8s ease-in-out infinite alternate;
}
@keyframes coinBob { from{transform:translateY(0)} to{transform:translateY(-8px)} }

.particle {
  position: absolute; border-radius: 50%; pointer-events: none; z-index: 20;
  animation: particleFade 0.6s ease-out forwards;
}
@keyframes particleFade {
  0%   { opacity:1; transform:scale(1) translate(0,0); }
  100% { opacity:0; transform:scale(0) translate(var(--dx), var(--dy)); }
}

.powerup {
  position: absolute; width: 28px; height: 28px; border-radius: 6px; z-index: 6;
  display: flex; align-items: center; justify-content: center; font-size: 16px;
  animation: powerupFloat 0.7s ease-in-out infinite alternate;
  box-shadow: 0 0 12px rgba(212,165,116,0.6);
  background: rgba(140,92,51,0.25); border: 2px solid #d4a574;
}
@keyframes powerupFloat { from{transform:translateY(0)} to{transform:translateY(-10px)} }

/* ‚îÄ‚îÄ COIN SAVE FLASH ‚îÄ‚îÄ */
.coin-save-flash {
  position: fixed;
  top: 65px; right: 20px;
  font-family: 'Orbitron', sans-serif;
  font-size: 0.75rem;
  font-weight: 700;
  color: #FFD700;
  background: rgba(26,13,5,0.9);
  border: 1px solid rgba(255,215,0,0.4);
  border-radius: 8px;
  padding: 6px 14px;
  z-index: 80;
  opacity: 0;
  transform: translateY(-8px);
  transition: opacity 0.3s, transform 0.3s;
  pointer-events: none;
}
.coin-save-flash.show { opacity: 1; transform: translateY(0); }

/* ‚îÄ‚îÄ MESSAGES ‚îÄ‚îÄ */
#message {
  position: fixed; top: 50%; left: 50%;
  transform: translate(-50%,-50%);
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(1.5rem, 5vw, 2.5rem);
  font-weight: 900; color: #d4a574;
  text-shadow: 0 0 20px rgba(212,165,116,0.9);
  pointer-events: none; z-index: 80; opacity: 0;
  transition: opacity 0.3s; text-align: center;
}

/* ‚îÄ‚îÄ GAME OVER ‚îÄ‚îÄ */
#gameOver {
  display: none; position: fixed; inset: 0;
  background: rgba(26,13,5,0.95); z-index: 90;
  align-items: center; justify-content: center;
  flex-direction: column; text-align: center; padding: 20px;
}
#gameOver.show { display: flex; animation: fadeIn 0.4s ease; }

#gameOver h2 {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(2rem, 7vw, 3.5rem);
  color: #f87171;
  text-shadow: 0 0 30px rgba(248,113,113,0.6);
  margin-bottom: 1rem;
}

#gameOver .final-stats {
  background: rgba(58,32,16,0.5);
  border: 1px solid #8c5c33;
  border-radius: 12px;
  padding: 20px 40px; margin-bottom: 1.5rem;
}

#gameOver .stat-line { font-size: 1.05rem; margin: 6px 0; color: #d4a574; }
#gameOver .stat-line span { color: #b8855a; font-weight: bold; }
#gameOver .stat-line.highlight { color: #FFD700; font-size: 1.2rem; }
#gameOver .stat-line.highlight span { color: #FFD700; }

/* all-time coins big display */
.alltime-box {
  background: rgba(255,215,0,0.07);
  border: 1px solid rgba(255,215,0,0.3);
  border-radius: 10px;
  padding: 12px 28px;
  margin-bottom: 1.5rem;
  text-align: center;
}
.alltime-box .at-label {
  font-size: 0.6rem;
  letter-spacing: 3px;
  color: #b8855a;
  text-transform: uppercase;
  margin-bottom: 4px;
}
.alltime-box .at-val {
  font-family: 'Orbitron', sans-serif;
  font-size: 2rem;
  font-weight: 900;
  color: #FFD700;
  text-shadow: 0 0 20px rgba(255,215,0,0.5);
}
.alltime-box .at-player {
  font-size: 0.75rem;
  color: #8c5c33;
  margin-top: 2px;
}

#gameOver .go-buttons { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; }

#gameOver button {
  padding: 12px 28px;
  font-family: 'Orbitron', sans-serif;
  font-size: 0.85rem; font-weight: 700;
  background: #8c5c33; color: #fff;
  border: 2px solid #d4a574; border-radius: 8px;
  cursor: pointer; letter-spacing: 1px; transition: all 0.2s;
}
#gameOver button:hover { background: #7a4f2d; box-shadow: 0 0 20px rgba(140,92,51,0.6); }
#gameOver .btn-secondary {
  background: transparent; color: #8c5c33;
  border-color: #5a3418;
}
#gameOver .btn-secondary:hover { color: #d4a574; border-color: #8c5c33; background: transparent; }

/* Pause */
#pauseOverlay {
  display: none; position: fixed; inset: 0;
  background: rgba(26,13,5,0.8); z-index: 70;
  align-items: center; justify-content: center;
  font-family: 'Orbitron', sans-serif; font-size: 3rem;
  color: #d4a574; text-shadow: 0 0 20px rgba(212,165,116,0.7);
}
#pauseOverlay.show { display: flex; }

/* Mobile */
#mobileControls {
  display: none; position: fixed; bottom: 20px; gap: 16px; z-index: 60;
}
@media (max-width: 768px), (pointer: coarse) { #mobileControls { display: flex; } }
.mob-btn {
  width: 70px; height: 70px; border-radius: 50%;
  border: 3px solid #8c5c33; background: rgba(140,92,51,0.2);
  color: #d4a574; font-size: 1.5rem; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  backdrop-filter: blur(4px); transition: all 0.1s;
  -webkit-tap-highlight-color: transparent;
}
.mob-btn:active { background: rgba(140,92,51,0.5); transform: scale(0.95); }

#character.shielded #shieldRing { opacity: 1 !important; }
#character.shielded { filter: drop-shadow(0 0 8px #d4a574); }
</style>
</head>
<body>

<!-- NAME SCREEN -->
<div id="nameScreen">
  <h1>SEISMIC RUNNER</h1>
  <p class="ns-sub">Enter your name to track your coins ‚Äî or jump straight in!</p>

  <div class="ns-box">
    <label for="playerNameInput">ü§ñ YOUR NAME <span style="color:#5a3a1a;font-size:0.7rem;">(optional)</span></label>
    <input type="text" id="playerNameInput" placeholder="Type your name..." maxlength="18" autocomplete="off" spellcheck="false"/>
    <div class="ns-wallet" id="walletPreview">
      <span style="color:#5a3a1a;">Name your player to save coins forever ü™ô</span>
    </div>
  </div>

  <button id="nameSubmitBtn" onclick="submitName()">ENTER GAME ‚Üí</button>

  <div style="margin: 18px 0 10px; width: min(420px,90vw);">
    <div class="ns-leaderboard">
      <h3>üèÜ ALL TIME COIN LEADERBOARD</h3>
      <div id="lbList"><div class="lb-empty">Loading...</div></div>
    </div>
  </div>
</div>

<!-- INTRO (difficulty select) -->
<div id="intro">
  <h1>SEISMIC RUNNER</h1>
  <p class="player-greeting" id="playerGreeting"></p>
  <div class="total-coins-banner">
    ü™ô All-time coins: <span class="tc-num" id="introCoinTotal">0</span>
  </div>
  <div class="controls-hint">
    <span>SPACE</span> / <span>‚Üë</span> = Jump &nbsp;|&nbsp; <span>‚Üì</span> = Duck &nbsp;|&nbsp; <span>P</span> = Pause<br>
    Double-jump supported! ü§ñ
  </div>
  <div class="mode-buttons">
    <button class="btn-easy" onclick="startGame('easy')">Easy</button>
    <button class="btn-hard" onclick="startGame('hard')">Hard</button>
    <button class="btn-vhard" onclick="startGame('vhard')">Very Hard</button>
  </div>
  <button class="btn-switch-player" onclick="switchPlayer()">‚Ü© Switch Player</button>
</div>

<!-- HUD -->
<div id="hud">
  <div class="hud-item">
    <span class="hud-label">Score</span>
    <span class="hud-val" id="scoreVal">0</span>
  </div>
  <div class="hud-item">
    <span class="hud-label">High Score</span>
    <span class="hud-val" id="highVal">0</span>
  </div>
  <div class="hud-item" id="coinItem" onclick="toggleCoins()" style="cursor:pointer;" title="Click to reveal">
    <span class="hud-label">This Run üîí</span>
    <span class="hud-val" id="coinVal" style="filter:blur(6px); transition:filter 0.3s;">0</span>
  </div>
  <div class="hud-item" id="allTimeCoinsHud">
    <span class="hud-label">Total ü™ô</span>
    <span class="hud-val" id="allTimeCoinVal">0</span>
  </div>
  <div class="hud-item">
    <span class="hud-label">Lives</span>
    <span class="hud-val" id="livesDisplay">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
  </div>
  <div class="hud-item">
    <span class="hud-label">Level</span>
    <span class="hud-val" id="levelVal">1</span>
  </div>
</div>

<!-- GAME -->
<div id="gameWrapper">
  <div id="gameArea">
    <div id="seismicBg"></div>
    <div id="ground"></div>
    <div id="seismicText">SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp; SEISMIC &nbsp;&nbsp;</div>
    <div id="character">
      <svg viewBox="0 0 80 100" xmlns="http://www.w3.org/2000/svg">
        <g id="bot-arm-l">
          <polygon points="4,26 16,22 18,44 6,48" fill="#7a4f2d" stroke="#3a2010" stroke-width="1.2"/>
          <ellipse cx="14" cy="24" rx="5" ry="4" fill="#1a1007"/>
          <polygon points="2,44 16,42 20,62 4,66" fill="#8c5c33" stroke="#3a2010" stroke-width="1.2"/>
          <polygon points="0,60 18,56 22,76 16,80 2,80" fill="#b8855a" stroke="#3a2010" stroke-width="1.2"/>
          <polygon points="2,76 10,72 18,74 16,80 2,80" fill="#9a6640" stroke="#3a2010" stroke-width="0.8"/>
        </g>
        <g id="bot-arm-r">
          <polygon points="76,26 64,22 62,44 74,48" fill="#7a4f2d" stroke="#3a2010" stroke-width="1.2"/>
          <ellipse cx="66" cy="24" rx="5" ry="4" fill="#1a1007"/>
          <polygon points="78,44 64,42 60,62 76,66" fill="#8c5c33" stroke="#3a2010" stroke-width="1.2"/>
          <polygon points="80,60 62,56 58,76 64,80 78,80" fill="#b8855a" stroke="#3a2010" stroke-width="1.2"/>
          <polygon points="78,76 70,72 62,74 64,80 78,80" fill="#9a6640" stroke="#3a2010" stroke-width="0.8"/>
        </g>
        <polygon points="18,22 62,22 66,56 14,56" fill="#7a4f2d" stroke="#3a2010" stroke-width="1.5"/>
        <polygon points="18,22 38,20 38,38 20,40" fill="#9a6640" stroke="#3a2010" stroke-width="0.8"/>
        <polygon points="42,20 62,22 60,40 42,38" fill="#6b4426" stroke="#3a2010" stroke-width="0.8"/>
        <polygon points="14,56 38,52 38,56" fill="#5a3418" stroke="#3a2010" stroke-width="0.8"/>
        <rect x="20" y="54" width="40" height="8" rx="2" fill="#1a1007"/>
        <rect x="24" y="55" width="32" height="6" rx="2" fill="#2d1f0e"/>
        <g id="bot-leg-l">
          <polygon points="22,62 38,62 36,76 20,76" fill="#8c5c33" stroke="#3a2010" stroke-width="1.2"/>
          <polygon points="20,74 38,74 40,80 18,80" fill="#6b4426" stroke="#3a2010" stroke-width="1"/>
          <polygon points="18,78 40,78 38,90 20,90" fill="#7a4f2d" stroke="#3a2010" stroke-width="1.2"/>
          <polygon points="16,88 42,88 44,98 14,98" fill="#b8855a" stroke="#3a2010" stroke-width="1.2"/>
          <polygon points="16,94 28,90 40,92 44,98 14,98" fill="#9a6640" stroke="#3a2010" stroke-width="0.8"/>
        </g>
        <g id="bot-leg-r">
          <polygon points="58,62 42,62 44,76 60,76" fill="#8c5c33" stroke="#3a2010" stroke-width="1.2"/>
          <polygon points="60,74 42,74 40,80 62,80" fill="#6b4426" stroke="#3a2010" stroke-width="1"/>
          <polygon points="62,78 40,78 42,90 60,90" fill="#7a4f2d" stroke="#3a2010" stroke-width="1.2"/>
          <polygon points="64,88 38,88 36,98 66,98" fill="#b8855a" stroke="#3a2010" stroke-width="1.2"/>
          <polygon points="64,94 52,90 40,92 36,98 66,98" fill="#9a6640" stroke="#3a2010" stroke-width="0.8"/>
        </g>
        <polygon points="26,6 54,6 58,22 22,22" fill="#7a4f2d" stroke="#3a2010" stroke-width="1.5"/>
        <polygon points="28,6 40,2 52,6 54,14 26,14" fill="#9a6640" stroke="#3a2010" stroke-width="0.8"/>
        <polygon points="30,14 50,14 54,22 26,22" fill="#6b4426" stroke="#3a2010" stroke-width="0.8"/>
        <circle cx="33" cy="13" r="3.5" fill="#fff"/>
        <circle cx="33" cy="13" r="2" fill="#1a1007"/>
        <circle cx="32.3" cy="12.3" r="0.7" fill="#fff" opacity="0.9"/>
        <circle cx="47" cy="13" r="3.5" fill="#fff"/>
        <circle cx="47" cy="13" r="2" fill="#1a1007"/>
        <circle cx="46.3" cy="12.3" r="0.7" fill="#fff" opacity="0.9"/>
        <circle id="shieldRing" cx="40" cy="50" r="44" fill="none" stroke="#4A90D9" stroke-width="3" opacity="0" stroke-dasharray="8 4">
          <animate attributeName="stroke-dashoffset" from="0" to="48" dur="1s" repeatCount="indefinite"/>
        </circle>
      </svg>
    </div>
  </div>
</div>

<!-- Coin save flash -->
<div class="coin-save-flash" id="coinSaveFlash"></div>

<!-- Message -->
<div id="message"></div>

<!-- Pause -->
<div id="pauseOverlay" class="pauseOverlay">‚è∏ PAUSED</div>

<!-- GAME OVER -->
<div id="gameOver">
  <h2>GAME OVER</h2>
  <div class="final-stats">
    <div class="stat-line">Score: <span id="finalScore">0</span></div>
    <div class="stat-line">High Score: <span id="finalHigh">0</span></div>
    <div class="stat-line">Coins This Run: <span id="finalCoins">0</span></div>
    <div class="stat-line">Level Reached: <span id="finalLevel">1</span></div>
  </div>
  <div class="alltime-box">
    <div class="at-label">All-Time Coin Wallet</div>
    <div class="at-val" id="goAllTimeCoins">0</div>
    <div class="at-player" id="goPlayerName"></div>
  </div>
  <div class="go-buttons">
    <button onclick="restartGame()">üîÑ Play Again</button>
    <button class="btn-secondary" onclick="switchPlayer()">‚Ü© Switch Player</button>
  </div>
</div>

<!-- Mobile controls -->
<div id="mobileControls">
  <button class="mob-btn" ontouchstart="startDuck()" ontouchend="stopDuck()">‚¨áÔ∏è</button>
  <button class="mob-btn" ontouchstart="jump()">‚¨ÜÔ∏è</button>
</div>

<script>
// ‚îÄ‚îÄ Elements ‚îÄ‚îÄ
const character    = document.getElementById("character");
const gameArea     = document.getElementById("gameArea");
const seismicBg    = document.getElementById("seismicBg");
const scoreEl      = document.getElementById("scoreVal");
const highEl       = document.getElementById("highVal");
const coinEl       = document.getElementById("coinVal");
const coinLabel    = document.querySelector("#coinItem .hud-label");
const allTimeCoinEl= document.getElementById("allTimeCoinVal");
const livesEl      = document.getElementById("livesDisplay");
const levelEl      = document.getElementById("levelVal");
const gameOverEl   = document.getElementById("gameOver");
const finalScoreEl = document.getElementById("finalScore");
const finalHighEl  = document.getElementById("finalHigh");
const finalCoinsEl = document.getElementById("finalCoins");
const finalLevelEl = document.getElementById("finalLevel");
const goAllTimeEl  = document.getElementById("goAllTimeCoins");
const goPlayerNameEl = document.getElementById("goPlayerName");
const messageEl    = document.getElementById("message");
const pauseEl      = document.getElementById("pauseOverlay");
const introEl      = document.getElementById("intro");
const nameScreenEl = document.getElementById("nameScreen");
const coinSaveFlash= document.getElementById("coinSaveFlash");
const lbListEl     = document.getElementById("lbList");

// ‚îÄ‚îÄ Player state ‚îÄ‚îÄ
let currentPlayer = null;   // player name string
let allTimeCoins  = 0;       // loaded from storage

// ‚îÄ‚îÄ Storage helpers (localStorage ‚Äî persists forever in this browser) ‚îÄ‚îÄ
const LS_PREFIX = "seismic_runner_";

function loadPlayerCoins(name) {
  try {
    const key = LS_PREFIX + "player_" + name.toLowerCase().replace(/\s+/g, "_");
    const raw = localStorage.getItem(key);
    if (raw) {
      const data = JSON.parse(raw);
      return data.totalCoins || 0;
    }
  } catch(e) {}
  return 0;
}

function savePlayerCoins(name, total) {
  try {
    const key = LS_PREFIX + "player_" + name.toLowerCase().replace(/\s+/g, "_");
    localStorage.setItem(key, JSON.stringify({ name, totalCoins: total, updated: Date.now() }));
    // Also update the players index so leaderboard works
    const indexKey = LS_PREFIX + "players_index";
    let index = [];
    try { index = JSON.parse(localStorage.getItem(indexKey) || "[]"); } catch(e) {}
    const normKey = name.toLowerCase().replace(/\s+/g, "_");
    if (!index.includes(normKey)) { index.push(normKey); localStorage.setItem(indexKey, JSON.stringify(index)); }
  } catch(e) {}
}

function loadLeaderboard() {
  try {
    const indexKey = LS_PREFIX + "players_index";
    let index = [];
    try { index = JSON.parse(localStorage.getItem(indexKey) || "[]"); } catch(e) {}
    const players = [];
    for (const normKey of index) {
      try {
        const raw = localStorage.getItem(LS_PREFIX + "player_" + normKey);
        if (raw) {
          const d = JSON.parse(raw);
          players.push({ name: d.name, totalCoins: d.totalCoins || 0 });
        }
      } catch(e) {}
    }
    players.sort((a,b) => b.totalCoins - a.totalCoins);
    return players.slice(0, 8);
  } catch(e) { return []; }
}

// ‚îÄ‚îÄ Name screen ‚îÄ‚îÄ
const nameInput = document.getElementById("playerNameInput");
const walletPreview = document.getElementById("walletPreview");

nameInput.addEventListener("input", debounce(() => {
  const n = nameInput.value.trim();
  if (!n) {
    walletPreview.innerHTML = '<span style="color:#5a3a1a;">Name your player to save coins forever ü™ô</span>';
    return;
  }
  const c = loadPlayerCoins(n);
  if (c > 0) {
    walletPreview.innerHTML = `Welcome back! ü™ô <span class="wallet-amt">${c.toLocaleString()}</span> coins saved`;
  } else {
    walletPreview.innerHTML = `<span style="color:#5a3a1a;">New player ‚Äî start earning coins!</span>`;
  }
}, 300));

nameInput.addEventListener("keydown", e => { if (e.key === "Enter") submitName(); });

function submitName() {
  const n = nameInput.value.trim();
  currentPlayer = n || null;
  allTimeCoins = n ? loadPlayerCoins(n) : 0;
  showIntro();
}

function showIntro() {
  nameScreenEl.style.display = "none";
  introEl.style.display = "flex";
  document.getElementById("playerGreeting").textContent = currentPlayer ? `Welcome, ${currentPlayer}!` : `Playing as Guest`;
  document.getElementById("introCoinTotal").textContent = allTimeCoins.toLocaleString();
}

function switchPlayer() {
  // Back to name screen
  gameOverEl.classList.remove("show");
  introEl.style.display = "none";
  nameScreenEl.style.display = "flex";
  nameInput.value = "";
  walletPreview.innerHTML = '<span style="color:#5a3a1a;">Enter a name to see your wallet</span>';
  currentPlayer = null;
  loadLeaderboardUI();
}

function loadLeaderboardUI() {
  lbListEl.innerHTML = '<div class="lb-empty">Loading...</div>';
  const players = loadLeaderboard();
  if (!players.length) {
    lbListEl.innerHTML = '<div class="lb-empty">No players yet ‚Äî be the first!</div>';
    return;
  }
  const medals = ["ü•á","ü•à","ü•â"];
  lbListEl.innerHTML = players.map((p, i) => `
    <div class="lb-row">
      <span class="lb-rank">${medals[i] || (i+1)}</span>
      <span class="lb-name">${escHtml(p.name)}</span>
      <span class="lb-coins">ü™ô ${p.totalCoins.toLocaleString()}</span>
    </div>
  `).join("");
}

function escHtml(s) {
  return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
}

// Load leaderboard on page start
loadLeaderboardUI();

// ‚îÄ‚îÄ Coins reveal toggle ‚îÄ‚îÄ
let coinsRevealed = false, hideCoinsTimer = null;
function toggleCoins() {
  coinsRevealed = !coinsRevealed;
  coinEl.style.filter = coinsRevealed ? "blur(0px)" : "blur(6px)";
  coinLabel.textContent = coinsRevealed ? "This Run üîì" : "This Run üîí";
  clearTimeout(hideCoinsTimer);
  if (coinsRevealed) {
    hideCoinsTimer = setTimeout(() => {
      coinsRevealed = false;
      coinEl.style.filter = "blur(6px)";
      coinLabel.textContent = "This Run üîí";
    }, 3000);
  }
}

// ‚îÄ‚îÄ Game State ‚îÄ‚îÄ
let score = 0, highScore = 0, coins = 0, lives = 3, level = 1;
let gameSpeed = 5, gameRunning = false, paused = false;
let obstacles = [], coinItems = [], powerups = [];
let gameInterval, obstacleInterval, coinInterval, powerupInterval, difficultyInterval;
let isJumping = false, jumpCount = 0, isDucking = false;
let charBottom = 0;
let shielded = false, shieldTimer = null;
let msgTimeout = null;

const GROUND = 4, MAX_JUMP = 220, GRAVITY = 0.55;
const CHAR_W = 72, CHAR_H = 90, DUCK_H = 50;

const difficulties = {
  easy:  { speed: 4,  obstacleFreq: 2200, maxH: 80,  minH: 30 },
  hard:  { speed: 6,  obstacleFreq: 1400, maxH: 110, minH: 35 },
  vhard: { speed: 9,  obstacleFreq: 900,  maxH: 140, minH: 40 }
};
let cfg;

function updateLives() { livesEl.textContent = "‚ù§Ô∏è".repeat(lives) || "üíÄ"; }
function updateAllTimeDisplay() {
  allTimeCoinEl.textContent = allTimeCoins.toLocaleString();
}

function showMessage(text, color = "#facc15") {
  clearTimeout(msgTimeout);
  messageEl.textContent = text;
  messageEl.style.color = color;
  messageEl.style.opacity = "1";
  msgTimeout = setTimeout(() => { messageEl.style.opacity = "0"; }, 1200);
}

function showCoinSaveFlash(added) {
  coinSaveFlash.textContent = `+${added} coins saved! ü™ô Total: ${allTimeCoins.toLocaleString()}`;
  coinSaveFlash.classList.add("show");
  setTimeout(() => coinSaveFlash.classList.remove("show"), 2500);
}

function startGame(mode) {
  cfg = difficulties[mode];
  gameSpeed = cfg.speed;
  introEl.style.display = "none";

  score = 0; coins = 0; lives = 3; level = 1;
  charBottom = GROUND;
  character.style.bottom = GROUND + "px";
  character.style.height = CHAR_H + "px";
  updateLives();
  updateHUD();
  updateAllTimeDisplay();

  gameRunning = true;
  gameInterval       = setInterval(gameLoop, 16);
  obstacleInterval   = setInterval(spawnObstacle, cfg.obstacleFreq);
  coinInterval       = setInterval(spawnCoin, 3000);
  powerupInterval    = setInterval(spawnPowerup, 8000);
  difficultyInterval = setInterval(increaseDifficulty, 10000);
}

function restartGame() {
  [gameInterval, obstacleInterval, coinInterval, powerupInterval, difficultyInterval].forEach(clearInterval);
  obstacles.forEach(o => o.el && o.el.remove());
  coinItems.forEach(c => c.el && c.el.remove());
  powerups.forEach(p => p.el && p.el.remove());
  obstacles = []; coinItems = []; powerups = [];
  gameOverEl.classList.remove("show");
  isJumping = false; jumpCount = 0; isDucking = false; shielded = false;
  character.classList.remove("hit","shielded");
  clearTimeout(shieldTimer);
  const m = cfg === difficulties.vhard ? 'vhard' : cfg === difficulties.hard ? 'hard' : 'easy';
  startGame(m);
}

function updateHUD() {
  scoreEl.textContent = score;
  highEl.textContent  = highScore;
  coinEl.textContent  = coins;
  levelEl.textContent = level;
}

function increaseDifficulty() {
  if (!gameRunning) return;
  level++;
  gameSpeed = Math.min(gameSpeed + 0.5, 16);
  showMessage(`LEVEL ${level}!`, "#b8855a");
  levelEl.textContent = level;
}

function jump() {
  if (!gameRunning || paused) return;
  if (jumpCount >= 2) return;
  jumpCount++;
  isJumping = true;
  let velocity = jumpCount === 1 ? 15 : 11;
  const ji = setInterval(() => {
    charBottom += velocity;
    velocity -= GRAVITY;
    if (charBottom > MAX_JUMP) charBottom = MAX_JUMP;
    if (charBottom <= GROUND) {
      charBottom = GROUND;
      clearInterval(ji);
      isJumping = false;
      jumpCount = 0;
      spawnLandParticles();
    }
    character.style.bottom = charBottom + "px";
  }, 16);
}

function startDuck() {
  if (!gameRunning || paused || isJumping) return;
  isDucking = true;
  character.style.height = DUCK_H + "px";
  character.style.bottom = GROUND + "px";
}
function stopDuck() {
  isDucking = false;
  character.style.height = CHAR_H + "px";
}

function spawnLandParticles() {
  for (let i = 0; i < 6; i++) {
    const p = document.createElement("div");
    p.className = "particle";
    const size = Math.random() * 6 + 3;
    const angle = Math.random() * 360;
    const dist  = Math.random() * 40 + 20;
    p.style.cssText = `width:${size}px;height:${size}px;background:#FF6B35;left:${106}px;bottom:4px;--dx:${Math.cos(angle*Math.PI/180)*dist}px;--dy:${Math.sin(angle*Math.PI/180)*dist-20}px;`;
    gameArea.appendChild(p);
    setTimeout(() => p.remove(), 600);
  }
}

function spawnHitParticles(x, y) {
  for (let i = 0; i < 10; i++) {
    const p = document.createElement("div");
    p.className = "particle";
    const size = Math.random() * 8 + 4;
    const angle = Math.random() * 360;
    const dist  = Math.random() * 60 + 20;
    p.style.cssText = `width:${size}px;height:${size}px;background:#f87171;left:${x}px;top:${y}px;--dx:${Math.cos(angle*Math.PI/180)*dist}px;--dy:${Math.sin(angle*Math.PI/180)*dist-30}px;`;
    gameArea.appendChild(p);
    setTimeout(() => p.remove(), 700);
  }
}

function spawnObstacle() {
  if (!gameRunning) return;
  const height = Math.floor(Math.random() * (cfg.maxH - cfg.minH + 1) + cfg.minH);
  const width  = Math.floor(Math.random() * 20 + 20);
  const el = document.createElement("div");
  el.className = "obstacle";
  el.style.height = height + "px";
  el.style.width  = width + "px";
  el.style.left   = gameArea.offsetWidth + "px";
  gameArea.appendChild(el);
  obstacles.push({ el, x: gameArea.offsetWidth, width, height });
}

function spawnCoin() {
  if (!gameRunning) return;
  const el = document.createElement("div");
  el.className = "coin";
  const bottom = Math.floor(Math.random() * 120 + 20);
  el.style.bottom = bottom + "px";
  el.style.left   = gameArea.offsetWidth + "px";
  gameArea.appendChild(el);
  coinItems.push({ el, x: gameArea.offsetWidth, bottom });
}

const powerTypes = [
  { emoji: "üõ°Ô∏è", type: "shield", label: "SHIELD!" },
  { emoji: "‚ö°",  type: "slow",   label: "SLOW!" },
  { emoji: "üí•",  type: "clear",  label: "CLEAR!" }
];

function spawnPowerup() {
  if (!gameRunning) return;
  const pw = powerTypes[Math.floor(Math.random() * powerTypes.length)];
  const el = document.createElement("div");
  el.className = "powerup";
  el.textContent = pw.emoji;
  const bottom = Math.floor(Math.random() * 100 + 40);
  el.style.bottom = bottom + "px";
  el.style.left   = gameArea.offsetWidth + "px";
  gameArea.appendChild(el);
  powerups.push({ el, x: gameArea.offsetWidth, bottom, ...pw });
}

function rectsOverlap(ax,ay,aw,ah,bx,by,bw,bh) {
  return ax < bx+bw && ax+aw > bx && ay < by+bh && ay+ah > by;
}

function getCharRect() {
  const charH = isDucking ? DUCK_H : CHAR_H;
  return { x: 78, y: gameArea.offsetHeight - charBottom - charH, w: CHAR_W - 20, h: charH - 10 };
}

function gameLoop() {
  if (!gameRunning || paused) return;
  score++;
  if (score > highScore) highScore = score;
  updateHUD();

  seismicBg.style.animation = `moveSeismic ${Math.max(0.4, 1.2 - gameSpeed * 0.05)}s linear infinite`;

  const ch = getCharRect();
  const aH = gameArea.offsetHeight;

  obstacles = obstacles.filter(obs => {
    obs.x -= gameSpeed;
    obs.el.style.left = obs.x + "px";
    if (obs.x < -obs.width - 10) { obs.el.remove(); return false; }
    const oy = aH - obs.height;
    if (!shielded && rectsOverlap(ch.x, ch.y, ch.w, ch.h, obs.x, oy, obs.width, obs.height)) handleHit(obs.x, oy);
    return true;
  });

  coinItems = coinItems.filter(c => {
    c.x -= gameSpeed;
    c.el.style.left = c.x + "px";
    if (c.x < -30) { c.el.remove(); return false; }
    const cy = aH - c.bottom - 22;
    if (rectsOverlap(ch.x, ch.y, ch.w, ch.h, c.x, cy, 22, 22)) {
      c.el.remove();
      coins++;
      updateHUD();
      showMessage(`+1 COIN ü™ô`, "#d4a574");
      return false;
    }
    return true;
  });

  powerups = powerups.filter(p => {
    p.x -= gameSpeed;
    p.el.style.left = p.x + "px";
    if (p.x < -40) { p.el.remove(); return false; }
    const py = aH - p.bottom - 28;
    if (rectsOverlap(ch.x, ch.y, ch.w, ch.h, p.x, py, 28, 28)) {
      p.el.remove();
      activatePowerup(p);
      return false;
    }
    return true;
  });
}

let hitCooldown = false;
function handleHit(ex, ey) {
  if (hitCooldown) return;
  hitCooldown = true;
  spawnHitParticles(ex, ey);
  lives--;
  updateLives();
  character.classList.add("hit");
  setTimeout(() => { character.classList.remove("hit"); hitCooldown = false; }, 600);
  if (lives <= 0) { endGame(); }
  else {
    showMessage(`üíî -1 Life! (${lives} left)`, "#f87171");
    shielded = true;
    setTimeout(() => { shielded = false; }, 1500);
  }
}

function activatePowerup(p) {
  showMessage(p.label + " üéâ", "#00f5d4");
  if (p.type === "shield") {
    shielded = true;
    character.classList.add("shielded");
    clearTimeout(shieldTimer);
    shieldTimer = setTimeout(() => { shielded = false; character.classList.remove("shielded"); }, 4000);
  } else if (p.type === "slow") {
    const old = gameSpeed;
    gameSpeed = Math.max(2, gameSpeed * 0.5);
    setTimeout(() => { gameSpeed = old; }, 4000);
  } else if (p.type === "clear") {
    obstacles.forEach(o => o.el.remove());
    obstacles = [];
  }
}

function endGame() {
  gameRunning = false;
  [gameInterval, obstacleInterval, coinInterval, powerupInterval, difficultyInterval].forEach(clearInterval);
  highScore = Math.max(highScore, score);

  // ‚îÄ‚îÄ Save coins permanently ‚îÄ‚îÄ
  if (currentPlayer && coins > 0) {
    allTimeCoins += coins;
    savePlayerCoins(currentPlayer, allTimeCoins);
    updateAllTimeDisplay();
    showCoinSaveFlash(coins);
  }

  finalScoreEl.textContent = score;
  finalHighEl.textContent  = highScore;
  finalCoinsEl.textContent = coins;
  finalLevelEl.textContent = level;
  goAllTimeEl.textContent  = allTimeCoins.toLocaleString();
  goPlayerNameEl.textContent = currentPlayer ? `${currentPlayer}'s wallet` : "Guest ‚Äî add a name to save coins!";
  gameOverEl.classList.add("show");
}

function togglePause() {
  if (!gameRunning) return;
  paused = !paused;
  pauseEl.classList.toggle("show", paused);
}

// ‚îÄ‚îÄ Keyboard ‚îÄ‚îÄ
document.addEventListener("keydown", e => {
  if (e.code === "Space" || e.code === "ArrowUp") { e.preventDefault(); jump(); }
  if (e.code === "ArrowDown") { e.preventDefault(); startDuck(); }
  if (e.code === "KeyP" || e.code === "Escape") togglePause();
});
document.addEventListener("keyup", e => { if (e.code === "ArrowDown") stopDuck(); });

// ‚îÄ‚îÄ Touch ‚îÄ‚îÄ
let touchStartY = 0;
document.addEventListener("touchstart", e => { touchStartY = e.touches[0].clientY; }, { passive: true });
document.addEventListener("touchend", e => {
  const dy = touchStartY - e.changedTouches[0].clientY;
  if (dy > 20) jump();
  if (dy < -20) startDuck();
}, { passive: true });

// ‚îÄ‚îÄ Utility ‚îÄ‚îÄ
function debounce(fn, ms) {
  let t;
  return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); };
}
</script>
</body>
</html>
